#!/bin/bash

# Получаем директорию, в которой находится сам скрипт
# Это позволяет запускать его из любого места
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"

echo "Запуск REST API сервера для Битрикс24 в фоновом режиме..."
# Запускаем основной REST API сервер в фоне и сохраняем его PID
node "$DIR/server.js" &
SERVER_PID=$!

# Даем серверу немного времени на запуск
sleep 2

echo "Запуск MCP-обертки для сервера Битрикс24..."
# Запускаем MCP-сервер, который будет общаться с нашим агентом
node "$DIR/mcp-server/mcp-server.js"

# Когда MCP-сервер завершится (например, по сигналу от агента),
# мы останавливаем и фоновый REST API сервер.
echo "Остановка фонового REST API сервера..."
kill $SERVER_PID 